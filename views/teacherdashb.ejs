
<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8">
    <title>Teacher Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="../css/dash.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet">
    

</head>

<body >

    <div class="navbar-fixed">
        <nav class="nav-natanedu">
            <div class="nav-wrapper">
              <a href="#" class="brand-logo"> 
                <img src="../img/logo.png" class="size-35 logo-nav"/>
              </a>
              <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="/profile">profile</a></li>
                <li><a href="#logout">logout</a></li>
              </ul>
            </div>
            
          </nav>
    
    </div>
    <div class="contaier" id="main">
        <div class="row">
            <div class="col s12">
                <div class="row">
                  <div class="col s4"></div>
                  
                  <div class="col s4">
                     
                          <ul class="collection hide" id="notification">
                          </ul>
                          <div class="grey-text lighten-3-text" style="margin-top:45%;text-align:center;" id="empty-notif">
                              <span  class="material-icons" style="font-size:38px">
                                  notifications</span><br/>
                              <span>No notification for now!</span>
                          </div>
                      
                  </div>
                  
                  <div class="col s4"></div>
                </div>
               
            </div>
        </div>
    </div>
              
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!-- web3 -->
    <script src="../js/makenotifcation.js"></script>
    <script src="../web3/web3.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    
    <script>
      $( document ).ready(function() {
        var elems_lang = document.querySelectorAll('#language-input .dropdown-trigger');
                M.Dropdown.init(elems_lang, {});

               
            });
            var topic="math";
                var min_price=0.1;
                var max_price=0.6;
                var lang="Arabic";
              var data;
            var socket = io.connect('http://localhost:8080/teachers');
              socket.on('ready', function(){
                  const hash = account;
                  console.log(hash);
                  const data = { wallet: hash, topic: topic, country: "tunisia",lang:lang,min:min_price,max:max_price };

                  socket.emit("try-to-join", data);
                 
                    
                });
                socket.on('joined', function(data){
                  console.log(data);
                 
                    
                });
               
                var title="Your courses";
                socket.on("class-available", function(student){
                  console.log(student);
                 
                  data=student;//JSON.parse(student);
                  if(data.prize<=max_price&&data.prize>=min_price&&data.lang==lang){
                    var d = new Date();
                    var id = d.getTime();
                    if (document.getElementById("notification").hasChildNodes()) {
                      $("#notification").removeClass("hide");
                      $("#empty-notif").addClass("hide");
                      }
                    $("#notification").append('<li id="'+id+'" class="collection-item avatar item-list" style="padding-left:20px;padding-top:20px;">'+
                      '<span class="title " style="font-size:20px;">'+topic+'</span>'+
                      ' <p class="grey-text">'+
                          data.student_name+' want a course with '+data.prize+'<br/>'+
                          'detail: '+data.chapitre+
                        '</p><br/>'+
                        '<div class="row">'+
                            '<button onclick="accecpt()" class="col s3 waves-effect waves-teal btn-small btn  accent-color" style="float:right">accept</button>'+
                          '<button onclick="denied('+id+')" class="col s3 waves-effect waves-light btn-small btn-flat denied-btn  red-text darken-1-text" style="float:right">denied</button>'+  
                        '</div>'+
                        '<div class="secondary-content">'+
                            parseInt(data.hour)+'hour'+
                      '</div>'+
                      '</li>');
                      data.topic=topic;
                  var text = 'The student  ' + data.student_name + ' want a course in '+data.topic;
                  createNotification(title,text);
                  }
                 
                  /*$("#notification").append('<div class="row">'+
                                              '<div class="col s12 m12">'+
                                                '<div class="card blue-grey lighten-5">'+
                                                  '<div class="card-content black-text">'+
                                                    '<span class="card-title title-center">new course in '+topic+'</span>'+
                                                        '<div class="row"><p class="pad-l-5">'+data.student_name+' want a course with '+data.prize+'</p></div>'+
                                                    '</div>'+
                                                  '<div class="card-action">'+
                                                    '<button class="waves-effect waves-light btn-flat ">denied</button>'+
                                                    '<button class="waves-effect waves-teal btn accent-color">accept</button>'+
                                                  '</div></div></div></div>'
                                             )*/
                  
                    
                });
                function denied(id){
                  $("#"+id).remove();
                  if (document.getElementById("notification").hasChildNodes()) {
                      $("#notification").addClass("hide");
                      $("#empty-notif").removeClass("hide");
                      }
                }
                function accecpt(){
                  
                  socket.emit("class-accepted", data.id);
                }
    </script>
 
</body>
</html>